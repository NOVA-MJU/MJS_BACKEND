{
  "openapi": "3.0.1",
  "info": {
    "title": "MJU 통합 검색 API",
    "version": "v1.0.0",
    "description": "Elasticsearch를 활용한 통합 검색, 연관 검색어 추천, 데이터 동기화 API입니다."
  },
  "servers": [
    {
      "url": "https://api.mjsearch.org/api/v1"
    }
  ],
  "tags": [
    {
      "name": "AI",
      "description": "Gemini와 Rag를 활용한 AI 연관 검색어"
    },
    {
      "name": "Search",
      "description": "Elasticsearch 연동을 통한 통합 검색 및 데이터 인덱싱 기능"
    },
    {
      "name": "Suggest",
      "description": "검색어 자동완성(연관어) 추천 기능"
    },
    {
      "name": "RealtimeKeyword",
      "description": "실시간 검색어 기록 및 조회 기능"
    }
  ],
  "paths": {
    "/ai/summary": {
      "get": {
        "tags": [
          "AI"
        ],
        "summary": "검색어 기반 AI 요약",
        "description": "검색어를 기준으로 Elasticsearch 문서를 분석하고, AI 모델을 통해 핵심 내용을 요약합니다. 요약 결과와 함께 요약에 사용된 문서 수 및 출처 링크를 반환합니다.",
        "parameters": [
          {
            "name": "query",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "요약을 생성할 검색어"
          }
        ],
        "responses": {
          "200": {
            "description": "AI 요약 결과 반환",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AiSummaryResponse"
                },
                "example": {
                  "query": "졸업",
                  "summary": "### 검색어 '졸업' - AI 요약\n\n2025년 8월 졸업 예정이거나 기졸업생을 위한 국민취업지원제도 참여 안내와 2025년 2월 졸업 대상자의 졸업사정 결과 조회, 2024학년도 후기 학위수여식 안내입니다.\n\n- 현재 기준으로 새로 공지된 일정은 아직 없습니다.\n  (참고) 2025년 8월 13일 9:00 ~ 2025년 8월 20일 17:00 (졸업사정 결과 조회 기간)\n\n2025년 8월 졸업예정자 및 기졸업생은 국민취업지원제도를 신청하여 인적성 무료 검사, 모의 면접 등의 취업 지원 혜택을 받을 수 있습니다.",
                  "document_count": 8,
                  "source_links": [
                    "https://www.mju.ac.kr/mjukr/255/subview.do?...",
                    "https://news.mju.ac.kr/news/articleView.html?idxno=13590"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/search/sync": {
      "post": {
        "tags": [
          "Search"
        ],
        "summary": "Elasticsearch 초기 데이터 동기화",
        "description": "DB의 데이터를 Elasticsearch에 일괄 인덱싱합니다. 주로 초기 세팅 또는 관리자 동기화 시 사용됩니다.",
        "responses": {
          "200": {
            "description": "인덱싱 완료 메시지 반환",
            "content": {
              "application/json": {
                "example": {
                  "status": "API 요청 성공",
                  "data": "Success Indexing",
                  "timestamp": "2025-07-18T02:47:14.860864"
                }
              }
            }
          }
        }
      }
    },
    "/search/detail": {
      "get": {
        "tags": [
          "Search"
        ],
        "summary": "통합 상세 검색 (type + category 이중 필터/정렬/페이지네이션)",
        "description": "키워드 기반 통합 검색 API입니다.\\n\\n동작 규칙\\n- `type`은 상위 탭 필터입니다. (`NOTICE`, `COMMUNITY`, `NEWS` 등)\\n- `category`는 문서의 세부 분류 필터입니다. (`NOTICE`의 경우 `general`, `academic` 등)\\n- `type`과 `category`를 함께 주면 **교집합(AND)** 조건으로 필터링합니다.\\n- `order`는 `relevance`(기본), `latest`, `oldest`를 지원합니다.\\n- 페이지네이션은 Spring Pageable 규약(`page`, `size`)을 따르며 기본값은 `page=0`, `size=10`입니다.\\n- `keyword`를 비우면 필터(`type`/`category`) + 정렬 기준으로 목록 조회처럼 동작합니다.\\n\\n권장 사용 예시\\n1) 전체 통합 검색: `/search/detail?keyword=졸업`\\n2) 탭만 제한: `/search/detail?keyword=졸업&type=NOTICE`\\n3) 탭 + 세부 카테고리 제한: `/search/detail?keyword=졸업&type=NOTICE&category=general`\\n4) 최신순 정렬: `/search/detail?keyword=장학금&type=NEWS&order=latest`\\n5) 페이지 이동: `/search/detail?keyword=기숙사&page=1&size=10`",
        "parameters": [
          {
            "name": "keyword",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "default": ""
            },
            "description": "검색어. 공백/미입력 시 match_all 기반으로 조회합니다."
          },
          {
            "name": "type",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "NOTICE",
                "COMMUNITY",
                "NEWS",
                "BROADCAST"
              ]
            },
            "description": "상위 검색 탭(type) 필터. 대소문자 무관하게 처리되며 내부 enum으로 정규화됩니다. 지원 값: `NOTICE`, `MJU_CALENDAR`, `DEPARTMENT_NOTICE`, `STUDENT_COUNCIL_NOTICE`, `DEPARTMENT_SCHEDULE`, `COMMUNITY`, `NEWS`, `BROADCAST`."
          },
          {
            "name": "category",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "example": "general"
            },
            "description": "문서의 `category` 컬럼 exact match 필터입니다. 아래 값은 **코드에서 실제 적재되는 값** 기준입니다.\\n\\ntype별 실제 category 적재값\\n- `NOTICE` → `general`, `academic`, `scholarship`, `career`, `activity`, `rule`, `law`\\n  - 근거: Notice 크롤링 레지스트리 key가 그대로 Notice.category로 저장되고, 통합 인덱스로 매핑됨\\n- `NEWS` → `REPORT`, `SOCIETY`\\n  - 근거: News.Category enum name() 값이 인덱스 category로 저장됨\\n- `COMMUNITY` → `FREE`, `NOTICE`\\n  - 근거: CommunityCategory enum name() 값이 인덱스 category로 저장됨\\n- `BROADCAST` → category 값 없음(null, 미적재)\\n- `MJU_CALENDAR` → category 값 없음(null, 미적재)\\n- `DEPARTMENT_SCHEDULE` → category 값 없음(null, 미적재)\\n- `STUDENT_COUNCIL_NOTICE` → category 값 없음(null, 미적재)\\n- `DEPARTMENT_NOTICE` → 현재 통합 검색 단일 타입 매핑 미구현 상태(운영상 미사용)\\n\\n주의사항\\n- category는 내부 정규화 없이 문자열 trim 후 그대로 term filter 됩니다.\\n- 즉 값/대소문자를 실제 적재값과 정확히 맞춰야 합니다."
          },
          {
            "name": "order",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "relevance",
                "latest",
                "oldest"
              ],
              "default": "relevance"
            },
            "description": "정렬 방식. relevance(정확도순), latest(최신순), oldest(오래된순)."
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "description": "0부터 시작하는 페이지 번호."
          },
          {
            "name": "size",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 10
            },
            "description": "페이지 크기. 미지정 시 10개."
          }
        ],
        "responses": {
          "200": {
            "description": "검색 결과 페이지 반환",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponsePageSearchResult"
                },
                "examples": {
                  "typeAndCategoryFilter": {
                    "summary": "type + category 동시 필터 (size=10 유지)",
                    "value": {
                      "status": "API 요청 성공",
                      "data": {
                        "content": [
                          {
                            "id": "NOTICE:13317",
                            "highlightedTitle": "2025학년도 8월 <em>졸업</em> 관련 안내",
                            "highlightedContent": "2025년 8월 <em>졸업</em>예정자 대상 일정 안내...",
                            "date": "2025-05-19T01:39:00",
                            "link": "https://www.mju.ac.kr/mjukr/255/subview.do?...",
                            "category": "general",
                            "type": "notice",
                            "imageUrl": "",
                            "score": 33.6482,
                            "authorName": "",
                            "likeCount": 0,
                            "commentCount": 0
                          }
                        ],
                        "pageable": {
                          "pageNumber": 0,
                          "pageSize": 10,
                          "sort": {
                            "empty": false,
                            "sorted": true,
                            "unsorted": false
                          },
                          "offset": 0,
                          "paged": true,
                          "unpaged": false
                        },
                        "last": false,
                        "totalElements": 42,
                        "totalPages": 5,
                        "size": 10,
                        "number": 0,
                        "sort": {
                          "empty": false,
                          "sorted": true,
                          "unsorted": false
                        },
                        "first": true,
                        "numberOfElements": 10,
                        "empty": false
                      },
                      "timestamp": "2026-02-20T10:58:19.1800413"
                    }
                  },
                  "typeOnlyFilter": {
                    "summary": "type만 제한 (category 미지정)",
                    "value": {
                      "status": "API 요청 성공",
                      "data": {
                        "content": [
                          {
                            "id": "NEWS:12941",
                            "highlightedTitle": "내년 인문캠 총학 <em>비대위</em>… 후보 불출마로 선거 무산",
                            "highlightedContent": "...총동아리연합회 비상대책위원회...",
                            "date": "2024-11-11T01:51:00",
                            "link": "https://news.mju.ac.kr/news/articleView.html?idxno=12941",
                            "category": "REPORT",
                            "type": "news",
                            "imageUrl": "http://news.mju.ac.kr/news/thumbnail//202411/12941_13881_1514_v150.jpg",
                            "score": 16.830822,
                            "authorName": "명대신문",
                            "likeCount": 0,
                            "commentCount": 0
                          }
                        ],
                        "pageable": {
                          "pageNumber": 0,
                          "pageSize": 10,
                          "sort": {
                            "empty": false,
                            "sorted": true,
                            "unsorted": false
                          },
                          "offset": 0,
                          "paged": true,
                          "unpaged": false
                        },
                        "last": false,
                        "totalElements": 128,
                        "totalPages": 13,
                        "size": 10,
                        "number": 0,
                        "sort": {
                          "empty": false,
                          "sorted": true,
                          "unsorted": false
                        },
                        "first": true,
                        "numberOfElements": 10,
                        "empty": false
                      },
                      "timestamp": "2026-02-20T10:58:19.1800413"
                    }
                  },
                  "emptyResult": {
                    "summary": "조건에 맞는 문서가 없을 때",
                    "value": {
                      "status": "API 요청 성공",
                      "data": {
                        "content": [],
                        "pageable": {
                          "pageNumber": 0,
                          "pageSize": 10,
                          "sort": {
                            "empty": true,
                            "sorted": false,
                            "unsorted": true
                          },
                          "offset": 0,
                          "paged": true,
                          "unpaged": false
                        },
                        "last": true,
                        "totalElements": 0,
                        "totalPages": 0,
                        "size": 10,
                        "number": 0,
                        "sort": {
                          "empty": true,
                          "sorted": false,
                          "unsorted": true
                        },
                        "first": true,
                        "numberOfElements": 0,
                        "empty": true
                      },
                      "timestamp": "2026-02-20T10:58:19.1800413"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },

    "/search/suggest": {
      "get": {
        "tags": [
          "Suggest"
        ],
        "summary": "자동완성 검색어 추천",
        "description": "입력한 키워드에 기반해 유사하거나 관련된 추천 검색어를 리스트 형태로 제공합니다.",
        "parameters": [
          {
            "name": "keyword",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "검색어 추천을 위한 키워드"
          }
        ],
        "responses": {
          "200": {
            "description": "추천 검색어 목록",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseStringArray"
                },
                "example": {
                  "status": "API 요청 성공",
                  "data": [
                    "장학금",
                    "장학 안내",
                    "장학생 신청"
                  ],
                  "timestamp": "2025-07-18T02:49:12.123456"
                }
              }
            }
          }
        }
      }
    },
    "/search/suggest/seasonal": {
      "get": {
        "tags": [
          "Suggest"
        ],
        "summary": "시기별 추천 검색어 조회",
        "description": "월(month)에 따라 화면 고정용 시기 텍스트(개강/시험/종강/방학/인기 검색어)와 추천 검색어 5개를 반환합니다. month를 주지 않으면 서버 현재 월 기준으로 계산합니다. 미운영 월(5월, 11월)은 실시간 인기 검색어를 반환합니다.",
        "parameters": [
          {
            "name": "month",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 12,
              "example": 3
            },
            "description": "조회 기준 월(1~12). 미입력 시 서버 현재 월 사용"
          }
        ],
        "responses": {
          "200": {
            "description": "시기 텍스트와 추천 검색어 목록 반환",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseSeasonalSuggestionResponse"
                },
                "examples": {
                  "개강": {
                    "summary": "개강 시기",
                    "value": {
                      "status": "API 요청 성공",
                      "data": {
                        "period": "개강",
                        "keywords": [
                          "수강신청",
                          "정정기간",
                          "수업계획서",
                          "강의실",
                          "학사일정"
                        ]
                      },
                      "timestamp": "2026-02-22T10:00:00.000000"
                    }
                  },
                  "미운영_인기검색어": {
                    "summary": "5월/11월",
                    "value": {
                      "status": "API 요청 성공",
                      "data": {
                        "period": "인기 검색어",
                        "keywords": [
                          "장학금",
                          "기숙사",
                          "중간고사",
                          "도서관",
                          "졸업"
                        ]
                      },
                      "timestamp": "2026-05-14T10:00:00.000000"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "잘못된 month 파라미터 (1~12 범위 외)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "status": 400,
                  "message": "month는 1~12 사이여야 합니다.",
                  "timestamp": "2026-02-22T10:00:00.000000"
                }
              }
            }
          }
        }
      }
    },
    "/keywords": {
      "post": {
        "tags": [
          "RealtimeKeyword"
        ],
        "summary": "검색어 기록",
        "description": "사용자가 입력한 검색어를 실시간 검색어 랭킹 집계에 기록합니다. 실제로는 별도로 요청하지 않고 검색을 하면 자동으로 추가하도록 검색에 추가되어 있습니다",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchKeywordRequestDTO"
              },
              "example": {
                "keyword": "장학금"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "검색어 기록 성공",
            "content": {
              "application/json": {
                "example": {
                  "status": "API 요청 성공",
                  "data": null,
                  "timestamp": "2025-07-18T03:00:00.000000"
                }
              }
            }
          }
        }
      }
    },
    "/keywords/top10": {
      "get": {
        "tags": [
          "RealtimeKeyword"
        ],
        "summary": "실시간 검색어 상위 조회",
        "description": "현재 집계된 실시간 검색어 중 상위 N개를 반환합니다.",
        "parameters": [
          {
            "name": "count",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 10,
              "minimum": 1
            },
            "description": "조회할 검색어 개수 (기본값 10)"
          }
        ],
        "responses": {
          "200": {
            "description": "상위 검색어 목록 반환",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseStringArray"
                },
                "example": {
                  "status": "API 요청 성공",
                  "data": [
                    "장학금",
                    "총학생회",
                    "강의평가",
                    "기숙사",
                    "등록금"
                  ],
                  "timestamp": "2025-07-18T03:05:00.000000"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "Authorization": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "AiSummaryResponse": {
        "type": "object",
        "properties": {
          "query": {
            "type": "string",
            "description": "사용자가 입력한 검색어"
          },
          "summary": {
            "type": "string",
            "description": "AI가 생성한 요약 결과 (Markdown 형식 가능)"
          },
          "document_count": {
            "type": "integer",
            "description": "요약에 사용된 Elasticsearch 문서 수"
          },
          "source_links": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uri"
            },
            "description": "요약에 사용된 원문 출처 링크 목록"
          }
        },
        "required": [
          "query",
          "summary",
          "document_count",
          "source_links"
        ]
      },
      "ApiResponsePageSearchResult": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string"
          },
          "data": {
            "$ref": "#/components/schemas/PageSearchResult"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ApiResponseOverviewMap": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string"
          },
          "data": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "$ref": "#/components/schemas/SearchResult"
              }
            },
            "description": "탭 키(notice, mjuCalendar, departmentNotice, departmentSchedule, community, news, broadcast)별 Top5 목록"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ApiResponseStringArray": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string"
          },
          "data": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ApiResponseSeasonalSuggestionResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string"
          },
          "data": {
            "$ref": "#/components/schemas/SeasonalSuggestionResponse"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SeasonalSuggestionResponse": {
        "type": "object",
        "properties": {
          "period": {
            "type": "string",
            "description": "화면 고정 노출용 시기 텍스트 (개강/시험/종강/방학/인기 검색어)",
            "example": "개강"
          },
          "keywords": {
            "type": "array",
            "description": "추천 검색어 목록(최대 5개)",
            "minItems": 0,
            "maxItems": 5,
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "period",
          "keywords"
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "integer",
            "example": 400
          },
          "message": {
            "type": "string",
            "example": "month는 1~12 사이여야 합니다."
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SearchResult": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "highlightedTitle": {
            "type": "string"
          },
          "highlightedContent": {
            "type": "string"
          },
          "date": {
            "type": "string",
            "format": "date-time"
          },
          "link": {
            "type": "string",
            "format": "uri"
          },
          "category": {
            "type": "string"
          },
          "type": {
            "type": "string"
          },
          "imageUrl": {
            "type": "string"
          },
          "score": {
            "type": "number",
            "format": "float"
          }
        }
      },
      "PageSearchResult": {
        "type": "object",
        "properties": {
          "content": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SearchResult"
            }
          },
          "pageable": {
            "type": "object",
            "properties": {
              "pageNumber": {
                "type": "integer"
              },
              "pageSize": {
                "type": "integer"
              },
              "sort": {
                "type": "object",
                "properties": {
                  "empty": {
                    "type": "boolean"
                  },
                  "sorted": {
                    "type": "boolean"
                  },
                  "unsorted": {
                    "type": "boolean"
                  }
                }
              },
              "offset": {
                "type": "integer"
              },
              "paged": {
                "type": "boolean"
              },
              "unpaged": {
                "type": "boolean"
              }
            }
          },
          "last": {
            "type": "boolean"
          },
          "totalPages": {
            "type": "integer"
          },
          "totalElements": {
            "type": "integer"
          },
          "first": {
            "type": "boolean"
          },
          "size": {
            "type": "integer"
          },
          "number": {
            "type": "integer"
          },
          "sort": {
            "type": "object",
            "properties": {
              "empty": {
                "type": "boolean"
              },
              "sorted": {
                "type": "boolean"
              },
              "unsorted": {
                "type": "boolean"
              }
            }
          },
          "numberOfElements": {
            "type": "integer"
          },
          "empty": {
            "type": "boolean"
          }
        }
      },
      "SearchKeywordRequestDTO": {
        "type": "object",
        "properties": {
          "keyword": {
            "type": "string",
            "description": "사용자가 검색한 키워드"
          }
        },
        "required": [
          "keyword"
        ]
      }
    }
  }
}
